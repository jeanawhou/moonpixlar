var canvas,imageObj=new Image,textarea=null,selectedFont=null,imageWidth,imageHeight,canvasWidth=600,canvasHeight=600,grid=40,saveFormat="png",selectedThemeId=-1,projectID,queries={};$.each(document.location.search.substr(1).split("&"),function(e,t){var a=t.split("=");a.length>1&&(queries[a[0].toString()]=a[1].toString())}),queries.cw&&(canvasWidth=queries.cw),queries.ch&&(canvasHeight=queries.ch),queries.pid&&(projectID=queries.pid),window.addEventListener("load",function e(){var t="#ffff00",a="#000000",n="2514829-69a8422361a1b4a8073fe1981",s=!1;window.FormData&&(formdata=new FormData,$("#imgUpload").removeClass("hidden"),document.getElementById("imgUploadbtn").style.display="none"),window.canvaApp=function(e){if(!e.container)throw new Error("Container not defined.");var n=this,s=$("#main"),i=s.find("#leftTools"),o=s.find("#workspace"),c=s.find("#leftToolsContent");Object.defineProperties(this,{$container:{value:s,writable:!1},$leftTools:{value:i,writable:!1},$workSpace:{value:o,writable:!1},$leftToolsContent:{value:c,writable:!1}}),n.setSelectedColor=function(e){t=e},n.getSelectedColor=function(){return t},n.setTextShadowColor=function(e){a=e},n.getTextShadowColor=function(){return a},n.setItemShadow=function(){var e={color:"#000000",blur:20,offsetX:10,offsetY:10,opacity:1,fillShadow:!0,strokeShadow:!0};return e},n.init(),n.manageEditorWindow()},canvaApp.prototype.manageEditorWindow=function(){var e=this,t=$(".editor_window").width(),a=$(".editor_window").height(),n=e.$canvas.width,s=e.$canvas.height,i=$(".canvas-container"),o;if(o=n>t-30?(t-30)/n:1,i.css({transform:"scale("+o+")"}),s>a-30)var o=(a-30)/s;else o=1;i.css({transform:"scale("+o+")",position:"absolute"});var c=$(".canvas-container")[0].getBoundingClientRect().width,r=$(".canvas-container")[0].getBoundingClientRect().height,l=parseInt(t)/2-parseInt(c)/2,d=parseInt(a)/2-parseInt(r)/2;i.css({left:l,top:d})},canvaApp.prototype._configure=function(){var e=this;$bgColorSelectionList=e.$container.find(".predefined-colors"),$.each(["#f00","#ff0","#0f0","#0ff","#00f","#f0f","#000","#fff"],function(){$bgColorSelectionList.append("<div class='color' data-color='"+this+"' style='background: "+this+"; color: "+this+";' ></div>")}),e.bindEvents(),"user"==queries.ttype&&e.getProject()},canvaApp.prototype.bindEvents=function(){var e=this,t=e.$container;t.find(".predefined-colors").on("click",".color",function(t){e.setBackgroundColor($(this).attr("data-color"))}),t.find(".add-color").colorpicker({container:!0,align:"left"}).on("changeColor",function(a){t.find(".add-color").css("background",a.color.toHex()),e.setBackgroundColor(a.color.toHex())}),t.find(".bg-list").on("click","a",function(t){t.preventDefault(),e.setBackgroundImage($(this).attr("data-image"))}),t.find("#text-designs").on("click",".text",function(t){e.addText($(this).attr("data-texttype"),$(this).attr("data-text"))}),t.find("#images").on("click",".thumbnail",function(t){e.addImage($(this).attr("data-image"))}),t.find("#leftTools").on("click",".clone-item",function(t){t.preventDefault(),e.cloneSelectedItem()}),t.find("#leftTools").on("click",".delete-item",function(t){t.preventDefault(),e.removeSelectedObject()}),t.find("#leftTools").on("click",".formating ",function(t){t.preventDefault(),e.setTextFormating($(this).attr("data-style"),this)}),t.find("#leftTools").on("click",".align ",function(t){t.preventDefault(),$(".align").removeClass("active"),$(this).addClass("active");var a,n=e.$canvas.getActiveObject().width;"left"==$(this).attr("data-align")?a=n/2:"right"==$(this).attr("data-align")?a=e.$canvas.width-n/2:"center"==$(this).attr("data-align")&&(a=e.$canvas.width/2),e.$canvas.getActiveObject().alignment=$(this).attr("data-align"),e.$canvas.getActiveObject().set("left",a).setCoords(),e.$canvas.renderAll()}),t.find("#leftTools").on("click",".rotation-icon ",function(t){t.preventDefault(),$(".rotation-icon").removeClass("active"),$(this).addClass("active"),e.$canvas.getActiveObject().set("angle",$(this).attr("data-rotation")).setCoords(),e.$canvas.renderAll()}),t.find("#textSettings").on("click",".opacity-icon ",function(t){t.preventDefault(),$(".opacity-icon").removeClass("active"),$(this).addClass("active"),e.setActiveStyle("opacity",parseInt($(this).attr("data-opacity"),10)/100),e.$canvas.renderAll()}),t.find("#leftTools").on("click",".send-backward",function(t){e.$canvas.getActiveObject().sendBackwards()}),t.find("#leftTools").on("click",".bring-forward",function(t){e.$canvas.getActiveObject().bringForward()}),t.find("#leftTools").on("click",".send-to-back",function(t){e.$canvas.getActiveObject().sendToBack()}),t.find("#leftTools").on("click",".bring-to-front",function(t){e.$canvas.getActiveObject().bringToFront()}),t.find("#textSettings").on("change","#colorControl",function(t){e.setSelectedColor=t.target.value,e.setActiveStyle("fill",t.target.value)}),t.find("#textSettings").on("change","#fSizeControl",function(t){e.setActiveStyle("fontSize",t.target.value)}),t.find("#textSettings").on("change","#font-family",function(t){WebFont.load({google:{families:[t.target.value]},active:function(){e.setActiveStyle("fontFamily",t.target.value)}})}),t.find("#textSettings").on("change",".object-shadow",function(){console.log("shadow change event"),console.log(this.checked),e.manageObjectShadow(this,"#textSettings")}),t.find("#image-settings").on("change",".object-shadow",function(){e.manageObjectShadow(this,"#image-settings")}),t.find("#textSettings").on("change",".shadow-distance",function(t){e.manageShadowDistance(t.target.value)}),t.find("#image-settings").on("change",".shadow-distance",function(t){e.manageShadowDistance(t.target.value)}),t.find("#textSettings").on("change",".shadowColorControl",function(t){e.manageShadowColor(t.target.value)}),t.find("#image-settings").on("change",".shadowColorControl",function(t){e.manageShadowColor(t.target.value)}),canvaApp.prototype.manageShadowColor=function(e){var t=this,a=t.$canvas.getActiveObject().getShadow();a.color=e,t.$canvas.getActiveObject().setShadow(a),t.$canvas.renderAll()},canvaApp.prototype.manageObjectShadow=function(e,t){var a=this,n={};e.checked?(n=a.setItemShadow(),$(t+" .shadow-distance-container,"+t+" .shadowColorControl").removeClass("hidden")):(n="",$(t+" .shadow-distance-container,"+t+" .shadowColorControl").addClass("hidden")),a.$canvas.getActiveObject().setShadow(n),a.$canvas.renderAll()},canvaApp.prototype.manageShadowDistance=function(e){var t=this,a=t.$canvas.getActiveObject().getShadow();a.offsetY=a.offsetX=parseInt(e),t.$canvas.getActiveObject().setShadow(a),t.$canvas.renderAll()},t.find("#leftTools").on("click",".increase",function(t){e.manageObjectPosition("increase",$(this).parent().attr("data-position"),0)}),t.find("#leftTools").on("click",".decrease",function(t){e.manageObjectPosition("decrease",$(this).parent().attr("data-position"),0)}),t.find("#leftTools").on("keyup",".object-position",function(t){e.manageObjectPosition("with-input",$(this).parent().attr("data-position"),$(this).val())}),t.find("#leftTools").on("change","#img-opacity,#shape-opacity",function(t){e.setActiveStyle("opacity",parseInt(t.target.value,10)/100),e.$canvas.renderAll()}),t.find(".shapes-list,.shapes-list1").on("click",".shape",function(t){t.preventDefault(),e.loadSelectedShape($(this).attr("data-image"))}),t.find(".themes-list").on("click",".theme",function(t){t.preventDefault(),selectedThemeId=$(this).attr("data-id"),$("#update-theme-btn")&&$("#update-theme-btn").removeClass("hidden"),$("#save-theme-btn")&&$("#save-theme-btn").addClass("hidden"),e.getTheme($(this).attr("data-id"))}),t.find(".my-projects-list").on("click",".myproject",function(t){t.preventDefault(),projectID=$(this).attr("data-id"),e.getProject()}),t.find(".basic-shapes").on("click",".shape",function(t){t.preventDefault(),e.loadSelectedShape($(this).attr("data-image"))}),t.find("#backgrounds .search-container").on("click",".btn",function(t){e.manageSearch("background",$("#backgrounds .search-container .search-key").val(),"#backgrounds",".backgrounds-list",".search-backgrounds-list",1)}),t.find("#images .search-container").on("click",".btn",function(t){$(".search-images-list").attr("data-page",1),e.manageSearch("images",$("#images .search-container .search-key").val(),"#images",".masonry",".search-images-list",1)}),t.find(".search-container").on("click",".fa-long-arrow-left",function(e){$(this).parents("#images").length>0&&($(".search-images-list .mCSB_container").html(""),$(".images-list").removeClass("hidden"),$("#images .search-container .search-key").val(""),$("#images .search-container .fa-long-arrow-left").addClass("hidden")),$(this).parents("#backgrounds").length>0&&($(".search-backgrounds-list .mCSB_container").html(""),$(".backgrounds-list").removeClass("hidden"),$("#backgrounds .search-container .search-key").val(""),$("#backgrounds .search-container .fa-long-arrow-left").addClass("hidden"))}),t.find(".upload-image-form").on("change","#imgUpload",function(t){for(var a=0,n=this.files.length,s,i,o;a<n;a++)o=this.files[a],o.type.match(/image.*/)&&(window.FileReader&&(i=new FileReader,i.onloadend=function(e){}),formdata&&formdata.append("images[]",o));formdata&&$.ajax({crossDomain:!0,url:globalarr.site_url+"/wp-content/themes/moonpixlar/upload.php",type:"POST",data:formdata,processData:!1,contentType:!1,async:!1,success:function(t){fabric.Image.fromURL(globalarr.site_url+"/wp-content/themes/moonpixlar/uploadedImages/"+t,function(t){e.$canvas.add(t)})},error:function(e){}})}),t.find('a[data-toggle="tab"]').on("shown.bs.tab",function(a){"shapes"==$(this).attr("aria-controls")?e.loadShapes():"themes"==$(this).attr("aria-controls")?e.loadThemes():"myProjects"==$(this).attr("aria-controls")&&e.loadProjects(".my-projects-list"),$(".settings-panel").addClass("hidden"),t.find(".tab-pane").removeClass("hidden")}),t.find(".mask-images li").on("click",function(t){var a=$(this).find("img").attr("src");e.manageMask(a)}),$("#snap-btn").on("click",function(e){$(this).toggleClass("active")}),$("#grid-btn").on("click",function(t){if($(this).hasClass("active"))$(this).removeClass("active"),e.hideGrid();else{$(this).addClass("active");var a=parseInt(jQuery("#grid-size").val())||40;a>e.$canvas.width/2&&(a=e.$canvas.width/2),e.showGrid(a)}}),$("#save-theme-btn").on("click",function(t){$(".loading-container").removeClass("hidden");var a=Array("width","height","orig_src","clip_left","clip_top","clip_width","clip_height","is_frame","id","gradientAngle"),n=JSON.stringify(e.$canvas.toJSON(a)),s=e.$canvas.toDataURL("image/jpeg");$.ajax({url:globalarr.site_url+"/wp-json/save-theme/post",type:"post",data:{theme_name:$("#projectName").val(),theme_width:e.$canvas.width,theme_height:e.$canvas.height,theme_tag:$("#projectTag").val(),theme_image:s,json_object:JSON.stringify(e.$canvas)},success:function(e,t){$(".loading-container").addClass("hidden")},error:function(e,t,a){}})}),$(".save-project-btn").on("click",function(t){$(".loading-container").removeClass("hidden"),e.saveProject()}),$("#update-theme-btn").on("click",function(t){e.updateTheme()}),$("#shapes .covers-btn").on("click",function(t){e.loadProjects(".covers-list"),$("#shapes .btn-group button").removeClass("active"),$(this).addClass("active"),$(".shapes-list").addClass("hidden"),$(".covers-list").removeClass("hidden"),$(".effects-list").addClass("hidden")}),$("#shapes .shapes-btn").on("click",function(t){e.loadShapes(),$("#shapes .btn-group button").removeClass("active"),$(this).addClass("active"),$(".shapes-list").removeClass("hidden"),$(".covers-list").addClass("hidden"),$(".effects-list").addClass("hidden")}),$("#shapes .effects-btn").on("click",function(t){e.loadEffects(),$("#shapes .btn-group button").removeClass("active"),$(this).addClass("active"),$(".shapes-list").addClass("hidden"),$(".covers-list").addClass("hidden"),$(".effects-list").removeClass("hidden")}),$("#backgrounds").on("scroll",function(t){var a=parseInt($("#backgrounds").prop("scrollHeight")),n=parseInt($(this).scrollTop()),s=parseInt($(this).height());if(s+n==a-10){console.log($(this).scrollTop()+"     "+$(this).height()+"  "+$("#backgrounds").prop("scrollHeight"));var i=parseInt($(".search-backgrounds-list").attr("data-page"));i+=1,$(".search-backgrounds-list").attr("data-page",i),e.manageSearch("background",$("#backgrounds .search-container .search-key").val(),"#backgrounds",".backgrounds-list",".search-backgrounds-list",i)}}),$("#images").on("scroll",function(t){var a=parseInt($("#images").prop("scrollHeight")),n=parseInt($(this).scrollTop()),s=parseInt($(this).height());if(s+n==a-10){var i=parseInt($(".search-images-list").attr("data-page"));i+=1,$(".search-images-list").attr("data-page",i),e.manageSearch("images",$("#images .search-container .search-key").val(),"#images",".masonry",".search-images-list",i)}}),e.$canvas.on("mouse:down",function(a){switch(a.target&&a.target.type){case"i-text":t.find(".settings-panel").addClass("hidden"),t.find("#textSettings").removeClass("hidden"),t.find(".tab-pane").addClass("hidden"),e.showTextSettings();break;case"image":t.find(".settings-panel").addClass("hidden"),t.find("#image-settings").removeClass("hidden"),t.find(".tab-pane").addClass("hidden"),e.updateImageSettings();break;case"path-group":case"group":e.showShapeSettings(a.target);break;default:t.find(".settings-panel").addClass("hidden"),t.find(".tab-pane").removeClass("hidden")}}),e.$canvas.on("object:moving",function(t){$("#snap-btn").hasClass("active")&&e.snapObjects(t)})},canvaApp.prototype.init=function(){var e=this;e.$canvas=new fabric.Canvas("canvas"),e.$canvas.setHeight(canvasHeight),e.$canvas.setWidth(canvasWidth),e._configure()},canvaApp.prototype.setBackgroundColor=function(e){var t=this;t.$canvas.backgroundImage=0,t.$canvas.setBackgroundColor(e),t.$canvas.renderAll()},canvaApp.prototype.setBackgroundImage=function(e){var t=this;fabric.Image.fromURL(e,function(e){e.set({originX:"left",originY:"top"});var a=parseInt(t.$canvas.width)/parseInt(e.getWidth());e.scale(a),t.$canvas.getHeight()>e.getHeight()&&e.scaleToHeight(t.$canvas.getHeight()),e.left=(t.$canvas.getWidth()-e.getWidth())/2,e.top=(t.$canvas.getHeight()-e.getHeight())/2,t.$canvas.setBackgroundImage(e,t.$canvas.renderAll.bind(t.$canvas))},{crossOrigin:"Anonymous"})},canvaApp.prototype.addText=function(e,t){var a=this,n;n="big"==e?36:"medium"==e?22:16;var s=new fabric.IText(t,{originX:"center",originY:"center",fontFamily:"Open Sans",fontSize:n,fill:"#ccc",fontWeight:"bold"});s.left=a.$canvas.width/2-s.width/2,s.top=a.$canvas.height/2-s.height/2;var i={color:"rgba(0,0,0,0.6)",blur:20,offsetX:10,offsetY:10,opacity:.6,fillShadow:!0,strokeShadow:!0};a.$canvas.add(s)},canvaApp.prototype.addImage=function(e){var t=this;fabric.Image.fromURL(e,function(e){t.$canvas.add(e)},{crossOrigin:"Anonymous"})},canvaApp.prototype.cloneSelectedItem=function(){var e=this,t=e.$canvas.getActiveObject();t&&(fabric.util.getKlass(t.type).async?t.clone(function(a){a.set({left:t.left+20,top:t.top+20}),e.$canvas.add(a)}):e.$canvas.add(t.clone().set({left:t.left+20,top:t.top+20})),e.$canvas.renderAll())},canvaApp.prototype.removeSelectedObject=function(){var e=this,t=e.$canvas.getActiveObject();e.$canvas.remove(t)},canvaApp.prototype.setTextFormating=function(e,t){var a=this;switch(e){case"italic":a.manageClassOnTextProps(t),a.setActiveStyle("fontStyle","italic"===a.getActiveStyle("fontStyle")?"":"italic");break;case"bold":a.manageClassOnTextProps(t),a.setActiveStyle("fontWeight","bold"===a.getActiveStyle("fontWeight")?"":"bold");break;case"underline":a.manageClassOnTextProps(t),a.setActiveStyle("textDecoration","underline"===a.getActiveStyle("textDecoration")?"":"underline")}},canvaApp.prototype.manageClassOnTextProps=function(e){var t=this;$(e).hasClass("active")?$(e).removeClass("active"):$(e).addClass("active")},canvaApp.prototype.setActiveStyle=function(e,t,a){var n=this;if(a=a||n.$canvas.getActiveObject()){if(a.setSelectionStyles&&a.isEditing){var s={};s[e]=t,a.setSelectionStyles(s),a.setCoords()}else a[e]=t;a.setCoords(),n.$canvas.renderAll()}},canvaApp.prototype.getActiveStyle=function(e,t){var a=this;return t=t||a.$canvas.getActiveObject(),t?t.getSelectionStyles&&t.isEditing?t.getSelectionStyles()[e]||"":t[e]||"":""},canvaApp.prototype.updateImageSettings=function(){var e=this;$("#image-settings #object-x-position").val(e.$canvas.getActiveObject().left),$("#image-settings #object-y-position").val(e.$canvas.getActiveObject().top);var t=e.$canvas.getActiveObject().getShadow();t&&$("#img-shadow").bootstrapSlider("setValue",parseInt(t.offsetX)).change()},canvaApp.prototype.showTextSettings=function(){var e=this;"bold"===e.getActiveStyle("fontWeight")?$(".formating.bold").addClass("active"):$(".formating.bold").removeClass("active"),"italic"===e.getActiveStyle("fontStyle")?$(".formating.italic").addClass("active"):$(".formating.italic").removeClass("active"),"underline"===e.getActiveStyle("textDecoration")?$(".formating.underline").addClass("active"):$(".formating.underline").removeClass("active"),"Helvetica"!=e.getActiveStyle("fontFamily")&&$("#font-family").val(e.getActiveStyle("fontFamily")).change(),$("#fSizeControl").bootstrapSlider("setValue",parseInt(e.getActiveStyle("fontSize"))).change();var t=e.$canvas.getActiveObject().getShadow();t&&($("#textSettings #shadow-distance-text").bootstrapSlider("setValue",parseInt(t.offsetX)).change(),$("#textSettings #shadowColorControl").val(t.color)),$("#textSettings #colorControl").val(e.getActiveStyle("fill"));var a=e.getActiveStyle("opacity");a*=100,$("#textSettings .opacity-icon").removeClass("active"),$("#textSettings .opacity-icon[data-opacity='"+a+"']").addClass("active");var n=e.$canvas.getActiveObject().alignment;$("#textSettings .align").removeClass("active"),$("#textSettings .align[data-align='"+n+"']").addClass("active")},canvaApp.prototype.manageObjectPosition=function(e,t,a){var n=this;switch("increase"==e?n.$canvas.getActiveObject()[t]=n.$canvas.getActiveObject()[t]+5:"decrease"==e?n.$canvas.getActiveObject()[t]=n.$canvas.getActiveObject()[t]-5:n.$canvas.getActiveObject()[t]=parseInt(a),n.$canvas.getActiveObject().type){case"image":$("#image-settings #object-x-position").val(n.$canvas.getActiveObject().left),$("#image-settings #object-y-position").val(n.$canvas.getActiveObject().top);break;case"shape":case"path-group":$(".shape-settings #object-x-position").val(n.$canvas.getActiveObject().left),$(".shape-settings #object-y-position").val(n.$canvas.getActiveObject().top)}n.$canvas.renderAll()},canvaApp.prototype.manageSearch=function(e,t,a,n,s,i){var o=this;$(".loading-container").removeClass("hidden"),$.ajax({url:globalarr.site_url+"/wp-json/get-pixabay-images/get",type:"get",data:{search_type:e,search_string:t,current_page:i},success:function(t,i){var t=JSON.parse(t);$(".loading-container").addClass("hidden"),parseInt(t.totalHits)>0?($(n).addClass("hidden"),$.each(t.hits,function(t,n){var i="background"==e?n.fullHDURL:n.webformatURL,o='<a href="#" class="thumbnail" data-image="'+i+'"><img src="'+n.previewURL+'" alt="bg" /></a>';$(s).append(o),$(a+" .search-container .fa-long-arrow-left").removeClass("hidden")})):console.log("No hits")},error:function(e,t,a){console.log(e),console.log("Details: "+t+"\nError:"+a)}})},canvaApp.prototype.manageMask=function(e){var t=this;fabric.Image.fromURL(e,function(e){e.width=200,e.height=200,e.left=t.$canvas.getActiveObject().left,e.top=t.$canvas.getActiveObject().top,t.$canvas.add(e),t.$canvas.sendBackwards(e),t.$canvas.getActiveObject().globalCompositeOperation="source-atop",t.$canvas.renderAll()})},canvaApp.prototype.snapObjects=function(e){e.target.set({left:Math.round(e.target.left/grid)*grid,top:Math.round(e.target.top/grid)*grid})},canvaApp.prototype.showGrid=function(e){grid=e;for(var t=this,a=0;a<t.$canvas.width/grid;a++)t.$canvas.add(new fabric.Line([0,a*grid,t.$canvas.width,a*grid],{stroke:"#ccc",selectable:!1,id:"grid-line"}));for(var a=0;a<t.$canvas.width/grid;a++)t.$canvas.add(new fabric.Line([a*grid,0,a*grid,t.$canvas.height],{stroke:"#ccc",selectable:!1,id:"grid-line"}))},canvaApp.prototype.hideGrid=function(){var e=this;e.$canvas.forEachObject(function(t,a){"grid-line"==t.id&&e.$canvas.item(a).remove()}),e.$canvas.renderAll()},canvaApp.prototype.loadShapes=function(){$(".shapes-list .mCSB_container").html(""),$(".loading-container").removeClass("hidden"),$.ajax({url:globalarr.site_url+"/wp-json/get-shapes/get",type:"GET",success:function(e){$(".loading-container").addClass("hidden"),jQuery.each(jQuery.parseJSON(e).data,function(e,t){var a='<a href="#" class="thumbnail shape" title="'+t.title+'" data-id="'+t.id+'" data-image="'+t.guid+'"><img src="'+t.guid+'" alt="'+t.title+'" /></a>';$(".shapes-list .mCSB_container").append(a),$(".shapes-list").mCustomScrollbar("update")})}})},canvaApp.prototype.loadEffects=function(){$(".effects-list .mCSB_container").html(""),$(".loading-container").removeClass("hidden"),$.ajax({url:globalarr.site_url+"/wp-json/get-effects/get",type:"GET",success:function(e){$(".loading-container").addClass("hidden"),jQuery.each(jQuery.parseJSON(e).data,function(e,t){var a='<a href="#" class="thumbnail effects" title="'+t.title+'" data-id="'+t.id+'" data-image="'+t.guid+'"><img src="'+t.guid+'" alt="'+t.title+'" /></a>';$(".effects-list .mCSB_container").append(a),$(".effects-list").mCustomScrollbar("update")})}})},canvaApp.prototype.loadThemes=function(){var e=this;$(".themes-list .mCSB_container").html(""),$.ajax({url:globalarr.site_url+"/wp-json/get-themes/get",type:"get",success:function(t,a){var t=JSON.parse(t),n=$.grep(t.data,function(t,a){return t.width==e.$canvas.width&&t.height==e.$canvas.height});jQuery.each(n,function(e,t){var a='<a href="#" class="thumbnail theme" title="'+t.title+'" data-id="'+t.theme_id+'"><img src="'+t.image+'" alt="'+t.tag+'" /></a>';$(".themes-list .mCSB_container").append(a),$(".themes-list").mCustomScrollbar("update")})},error:function(e,t,a){}})},canvaApp.prototype.loadProjects=function(e){$(e+" .mCSB_container").html(""),$(".loading-container").removeClass("hidden"),$.ajax({url:globalarr.site_url+"/wp-json/get-projects/post",type:"post",data:{user_id:globalarr.user_id,user_key:globalarr.user_key},success:function(t,a){$(".loading-container").addClass("hidden");var t=JSON.parse(t);jQuery.each(t.data,function(t,a){var n='<a href="#" class="thumbnail myproject" title="'+a.title+'" data-projectuser="'+a.project_user+'" data-id="'+a.project_id+'"><img src="'+a.image+'" alt="'+a.tag+'" /></a>';$(e+" .mCSB_container").append(n),$(e).mCustomScrollbar("update")}),$(e).mCustomScrollbar({callbacks:{onScroll:function(){console.log("Content scrolled...")}}})},error:function(e,t,a){}})},canvaApp.prototype.getTheme=function(e){var t=this,t=this;$(".loading-container").removeClass("hidden"),$.ajax({url:globalarr.site_url+"/wp-json/get-theme/get",type:"get",data:{theme_id:e},success:function(e,a){var e=JSON.parse(e);jQuery.each(e,function(e,a){t.$canvas.loadFromJSON(a.json_object,function(){t.$canvas.renderAll(),$(".loading-container").addClass("hidden")})})}})},canvaApp.prototype.saveProject=function(){var e=this,t=Array("width","height","orig_src","clip_left","clip_top","clip_width","clip_height","is_frame","id","gradientAngle"),a=JSON.stringify(e.$canvas.toJSON(t)),n=e.$canvas.toDataURL("image/jpeg");$.ajax({url:globalarr.site_url+"/wp-json/save-project/post",type:"post",data:{user_id:globalarr.user_id,user_key:globalarr.user_key,project_name:$("#projectName").val(),project_width:e.$canvas.width,project_height:e.$canvas.height,project_tag:$("#projectTag").val(),project_image:n,json_object:JSON.stringify(e.$canvas),type:"test",project_id:projectID},success:function(e,t){$(".loading-container").addClass("hidden")},error:function(e,t,a){console.log(a)}})},canvaApp.prototype.getProject=function(){var e=this;e.$canvas.clear(),$(".loading-container").removeClass("hidden"),$.ajax({url:globalarr.site_url+"/wp-json/get-project/post",type:"post",data:{user_id:globalarr.user_id,user_key:globalarr.user_key,project_id:projectID},success:function(t,a){var t=JSON.parse(t),n=t.data.json_object.replace(/\\/g,"");e.$canvas.loadFromJSON(n,function(){e.$canvas.renderAll()}),$(".loading-container").addClass("hidden")}})},canvaApp.prototype.updateTheme=function(){var e=this,t=e.$canvas.toDataURL("image/png");$(".loading-container").removeClass("hidden"),$.ajax({url:"api.php?rquest=updateTheme",type:"POST",data:{json_object:JSON.stringify(e.$canvas),width:e.$canvas.width,height:e.$canvas.height,theme_name:"Test Theme1",tag:"New Year",thumbnail:t,theme_id:selectedThemeId},success:function(e){$(".loading-container").addClass("hidden")}})},canvaApp.prototype.loadSelectedShape=function(e){var t=this;fabric.loadSVGFromURL(e,function(e,a){var n=fabric.util.groupSVGElements(e,a);t.$canvas.add(n).centerObject(n).renderAll(),n.setCoords()}),t.$canvas.renderAll()},Array.prototype.getDuplicates=function(){for(var e={},t=0;t<this.length;t++)e.hasOwnProperty(this[t])?e[this[t]].push(t):this.lastIndexOf(this[t])!==t&&(e[this[t]]=[t]);return e},canvaApp.prototype.showShapeSettings=function(e){var t=this,a=t.$canvas.getActiveObject()||t.$canvas.getActiveGroup(),n=new Array;for(var s in a.paths)a.paths.hasOwnProperty(s)&&""!=a.paths[s].fill&&n.push(a.paths[s].fill);var i=n.getDuplicates(),o=[],c=[];for(r=0;r<n.length;r++)o.indexOf(n[r])===-1&&(o.push(n[r]),c.push(r));$(".shape-colors").html("");for(var r=0;r<o.length;r++)void 0!=i[o[r]]?$(".shape-colors").append('<div class="shape-color" data-group="'+i[o[r]]+'" data-old-color="'+o[r]+'" data-new-color=""><div style="background:'+o[r]+'" class="shape-color-preview" ></div><i class="fa fa-caret-down"></i></div>'):$(".shape-colors").append('<div class="shape-color" data-group="'+c[r]+'" data-old-color="'+o[r]+'" data-new-color=""><div style="background:'+o[r]+'" class="shape-color-preview" ></div><i class="fa fa-caret-down"></i></div>');$(".settings-panel").addClass("hidden"),$(".tab-pane").addClass("hidden"),$(".shape-edit-panel").removeClass("hidden"),$(".shape-colors").find(".shape-color").colorpicker({container:!0,align:"left"}).on("changeColor",function(e){var n=$(this).attr("data-group").split(",");for(var s in n)if(n.hasOwnProperty(s)){var i=parseInt(n[s]);a.paths[i].fill=e.color.toHex()}$(this).find(".shape-color-preview").css("background",e.color.toHex()),t.$canvas.renderAll()}),t.$canvas.renderAll()},canvaApp.prototype.loadTheme=function(e){var t=this;t.$canvas.loadFromJSON(e,function(){t.$canvas.renderAll()})},canvaApp.prototype.saveCanvasAsImage=function(e){var t=this,a=t.$canvas.getActiveObject();a&&(a.hasBorders=a.hasControls=!1),t.$canvas.renderAll();var n=t.$canvas.toDataURL({format:e,quality:1}),s=t.dataURItoBlob(n,"image/"+e);saveAs(s,"canvas."+e)},canvaApp.prototype.dataURItoBlob=function(e,t){for(var a=atob(e.split(",")[1]),n=new ArrayBuffer(a.length),s=new Uint8Array(n),i=0;i<a.length;i++)s[i]=a.charCodeAt(i);return new Blob([n],{type:t})},canvaApp.prototype.loadContentOnScroll=function(e){var t=this;switch(e){case"shapes-list":break;case"images-list":var a=parseInt($(".search-images-list").attr("data-page"));a+=1,$(".search-images-list").attr("data-page",a),t.manageSearch("images",$("#images .search-container .search-key").val(),"#images",".masonry",".search-images-list",a);break;case"backgrounds-list":var a=parseInt($(".search-backgrounds-list").attr("data-page"));a+=1,$(".search-backgrounds-list").attr("data-page",a),t.manageSearch("background",$("#backgrounds .search-container .search-key").val(),"#backgrounds",".backgrounds-list",".search-backgrounds-list",a)}}});